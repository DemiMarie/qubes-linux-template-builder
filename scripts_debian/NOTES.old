=====================================================================
These are my original notes for steps to intergrate Whonix into Qubes
=====================================================================

Read README.whonix qubes-builder package for build instructions

None of the notes below apply at this point but I am saving them 
until whonix intergration is complete since there still may be some 
valid steps I will need to intergrate ubuntu as well

=====================================================================
# Build depends
sudo yum install rpmdevtools rpm-build createrepo rpm-sign

# Additional for debian template
sudo yum install debootstrap dpkg-dev

# Build
# https://qubes-os.org/wiki/BuildingArchlinuxTemplate
# ---------------------------------------------------
clean all
clean all rpms
sudo umount chroot-wheezy/proc
sudo rm -r chroot-wheezy
cd qubes-src/linus-template-builder
sudo umount mnt
sudo rm prepared_images/...

make get-sources

make vmm-xen-vm
make core-vchan-xen-vm
make linux-utils-vm
make core-agent-linux-vm
make gui-common-vm
make gui-agent-linux-vm

make linux-template-builder


# builder.conf
# ------------
GIT_SUBDIR=marmarek
COMPONENTS:=$(filter-out desktop-linux-kde desktop-linux-xfce,$(COMPONENTS))
DISTS_VM=wheezy
NO_SIGN="1"
DEBUG="1"
VERBOSE=2


# Changed (XXX: Marks the spot!)
# ------------------------------
# Makefile.debian
#   - wheezy repo dir does not get created...
# prepare-chroot-debian
#   - chroot /dev/null should be 0666


# Wheezy needs a keyring
# ----------------------
# Create in keys_debian
# Get from https://ftp-master.debian.org/keys.html
gpg --no-default-keyring --keyring=wheezy-debian-archive-keyring.gpg --import wheezy-archive-key-7.0.asc 
# move from /user/home/.gnupgp to keys_debian


# Wheezy Hacks
# ------------
# Need 2.0 pulse audio drivers
# *add to source list*
cd qubes-src
git clone --branch v2.0 git://anongit.freedesktop.org/pulseaudio/pulseaudio
cp -prf pulseaudio/src/pulsecore gui-agent-linux/pulse/pulsecore-2.0
cd ..

# Add to...
# module-vchan-sink-symdef.h

#elif PA_CHECK_VERSION(2,0,0)
bool pa__load_once(void);

# Add to..
# Makefile


# Build errors - template
# -----------------------
make[1]: *** [update-repo] Error 32
make: *** [linux-template-builder] Error 1
mount: mount(2) failed: No such file or directory

- remove all mounts and try again.  Some mounts may need to be tried multiple times

$ sudo umount chroot-wheezy/proc/
$ sudo umount chroot-wheezy/proc/
umount: chroot-wheezy/proc/: not mounted

$ sudo umount chroot-wheezy/tmp/qubes-apt-repo/
$ sudo umount chroot-wheezy/tmp/qubes-apt-repo/
umount: chroot-wheezy/tmp/qubes-apt-repo/: not mounted

$ sudo umount chroot-wheezy/tmp/qubes-deb/     
$ sudo umount chroot-wheezy/tmp/qubes-deb/
$ sudo umount chroot-wheezy/tmp/qubes-deb/
umount: chroot-wheezy/tmp/qubes-deb/: not mounted

